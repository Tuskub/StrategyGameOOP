<!DOCTYPE html>
<html>
<head>
<style>	
*,
*::after,
*::before {
  margin: 0;
  padding: 0;
  box-sizing: inherit; 
}

html {
  box-sizing: border-box;
  font-size: 62.5%; 
}

body {
  font-family: "Nunito", sans-serif;
  color: #333;
  font-weight: 300;
}

.container {
  width: 65%;
  margin: 0 auto; 

}

.gamemap {
  display: grid;
  grid-template-columns: repeat(18, 2.5fr);
  grid-template-rows: repeat(18, 2.5vw); 
}

.gamemap__img {
  width: 100%;
  height: 100%;
}

.gamemap__item {
  display: table-cell;
  vertical-align: middle;
  text-align: center;
  border: 1px solid black;
}
</style>
</head>
<body>
  <form style="font-family: 'Nunito', sans-serif; color: #333; font-size: 20px;" action="" method="post" novalidate>
    {{ form.hidden_tag() }}
    {{ form.unit.label }}
    {{ form.unit(size=32, autocomplete="off") }}
    {% for error in form.unit.errors %}
      <span style="color: red;">[{{ error }}]</span>
    {% endfor %}
    {{ form.action }}
    {{ form.target.label }}
    {{ form.target(size=32, autocomplete="off") }}
    {% for error in form.target.errors %}
      <span style="color: red;">[{{ error }}]</span>
    {% endfor %}
    {{ form.submit() }}
  </form>
  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <ul>
      {% for message in messages %}
      <li style="color: red; font-size: 15px;">{{ message }}</li>
      {% endfor %}
  </ul>
  {% endif %}
  {% endwith %}  
  <div class="container">
    <div class="gamemap" id='grid'>
      {% for cell in map.grounds %}
        <div data-coordinates="{{ cell.x }} {{ cell.y }}" style="background-image: url('{{ cell.img_path }}'); grid-column: {{ cell.y }}; grid-row: {{ cell.x }};" class="gamemap__item" >
          {% if map.get_unit_by_point(cell.x, cell.y) != None %}
            <img src="{{ map.get_unit_by_point(cell.x, cell.y).get_img_path() }}" class="gamemap__img"/>
          {% endif %}  
        </div>
      {% endfor %}
    </div>
  </div>
  <script>
    let past_unit = {
      background: null,
      coordinates: null
    }
    let past_target = {
      background: null,
      coordinates: null
    }
    document.getElementById('unit').addEventListener('input', function(e){
      if(!(/\d{1,2}\s\d{1,2}/).test(this.value))
        return;
      let past_cell = document.querySelector(`div[data-coordinates="${past_unit.coordinates}"]`)
      if(past_cell != null){
        past_cell.style.backgroundImage = `${past_unit.background}`;
      }
      const grid = document.getElementById('grid')
      let unit = document.querySelector(`div[data-coordinates="${this.value}"]`)
      past.background = unit.style.backgroundImage
      unit.style.backgroundImage = 'url(/static/img/textures/GrassB.png)';
      past.coordinates = this.value;
    });

    document.getElementById('target').addEventListener('input', function(e){
      if(!(/\d{1,2}\s\d{1,2}/).test(this.value))
        return;
      let past_cell = document.querySelector(`div[data-coordinates="${past_target.coordinates}"]`)
      if(past_cell != null){
        past_cell.style.backgroundImage = `${past_target.background}`;
      }
      const grid = document.getElementById('grid')
      let target = document.querySelector(`div[data-coordinates="${this.value}"]`)
      past_target.background = target.style.backgroundImage
      target.style.backgroundImage = 'url(/static/img/textures/GrassB.png)';
      past_target.coordinates = this.value;
    });
  </script>
</body>
</html>